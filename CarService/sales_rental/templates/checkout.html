<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  {% load static %}
  <title>CarGO - Checkout</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <link rel="stylesheet" href="{% static 'css/checkout.css' %}">
  <script>
    function calculateTotal() {
      const rentalPricePerDay = parseFloat(document.getElementById('rentalPricePerDay').value);
      const startDate = new Date(document.getElementById('startdate').value);
      const endDate = new Date(document.getElementById('enddate').value);
      const totalPriceElement = document.getElementById('totalPrice');
      const rentalDaysDisplay = document.getElementById('rentalDaysDisplay');
      
      if (startDate && endDate && startDate < endDate) {
        const timeDifference = endDate - startDate;
        const rentalDays = Math.ceil(timeDifference / (1000 * 3600 * 24)); // Ensure full day calculation
        const totalPrice = rentalPricePerDay * rentalDays;
        totalPriceElement.innerText = `$${totalPrice.toFixed(2)}`;
        rentalDaysDisplay.innerText = rentalDays;
      } else {
        totalPriceElement.innerText = "Invalid date range";
        rentalDaysDisplay.innerText = 0;
      }
    }
  </script>
</head>
<body>

<h2>Checkout Form</h2>
<div class="row">
  <div class="col-75">
    <div class="container">
      <form action="{% url 'process_checkout' %}" method="post">
        {% csrf_token %}
        <input type="hidden" name="transaction_type" value="{{ transaction_type }}">
        <input type="hidden" name="car_id" value="{{ car.id }}">
        <div class="row">
          <div class="col-50">
            <h3>Billing Address</h3>
            <label for="fname"><i class="fa fa-user"></i> Full Name</label>
            <input type="text" id="fname" name="firstname" placeholder="John Doe" required>
            <label for="email"><i class="fa fa-envelope"></i> Email</label>
            <input type="email" id="email" name="email" placeholder="john@example.com" required>
            <label for="phone"><i class="fa fa-phone"></i> Phone Number</label>
            <input type="tel" id="phone" name="phone" placeholder="123-456-7890" required>
            <label for="adr"><i class="fa fa-address-card-o"></i> Address</label>
            <input type="text" id="adr" name="address" placeholder="542 W. 15th Street" required>
            <label for="city"><i class="fa fa-institution"></i> City</label>
            <input type="text" id="city" name="city" placeholder="New York" required>
          </div>

          <div class="col-50">
            <h3>Payment</h3>
            <label for="paymentMethod">Payment Method</label>
            <select id="paymentMethod" name="paymentMethod" required>
              <option value="khalti">Khalti</option>
              <option value="cash">Cash</option>
            </select>

            {% if transaction_type == "rent" %}
            <input type="hidden" id="rentalPricePerDay" value="{{ rental_price_per_day }}">
            <label for="startdate">Start Date and Time</label>
            <input type="datetime-local" id="startdate" name="startdate" required oninput="calculateTotal()">
            <label for="enddate">End Date and Time</label>
            <input type="datetime-local" id="enddate" name="enddate" required oninput="calculateTotal()">
            {% else %}
            <label for="pickupdate">Pick Up Date</label>
            <input type="date" id="pickupdate" name="pickupdate" required>
            {% endif %}
          </div>
        </div>
        <label>
          <input type="checkbox" checked="checked" name="sameadr"> Shipping address same as billing
        </label>
        <input type="submit" value="Continue to checkout" class="btn">
      </form>
    </div>
  </div>
  <div class="col-25">
    <div class="container">
      <h4>Cart</h4>
      <p><a href="#">{{ car.make }} {{ car.model }} ({{ car.year }})</a> 
         <span class="price">
            {% if transaction_type == "rent" %}
              ${{ rental_price_per_day }} per day
            {% else %}
              ${{ total_price }}
            {% endif %}
         </span>
      </p>
      {% if transaction_type == "rent" %}
      <p>Number of rental days: <span id="rentalDaysDisplay">{{ rental_days }}</span></p>
      {% endif %}
      <hr>
      <p>Total <span id="totalPrice" class="price" style="color:black"><b>${{ total_price }}</b></span></p>
    </div>
  </div>
</div>

</body>
</html>

